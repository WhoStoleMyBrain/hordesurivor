import 'ids.dart';
import 'skill_display.dart';
import 'tags.dart';

class SkillDef {
  const SkillDef({
    required this.id,
    required this.name,
    required this.iconId,
    required this.description,
    required this.tags,
    this.metaUnlockId,
    this.statusEffects = const {},
    this.displayDetails = const [],
    this.knockbackForce = 0,
    this.knockbackDuration = 0,
    this.deflectRadius = 0,
    this.deflectDuration = 0,
    this.weight = 1,
  });

  final SkillId id;
  final String name;
  final String iconId;
  final String description;
  final TagSet tags;
  final MetaUnlockId? metaUnlockId;
  final Set<StatusEffectId> statusEffects;
  final List<SkillDetailLine> displayDetails;
  final double knockbackForce;
  final double knockbackDuration;
  final double deflectRadius;
  final double deflectDuration;
  final int weight;
}

final List<SkillDef> skillDefs = [
  SkillDef(
    id: SkillId.fireball,
    name: 'Censer Ember',
    iconId: 'skill_censer_ember',
    description: 'Fling a burning coal from the censer.',
    tags: TagSet(
      elements: {ElementTag.fire},
      deliveries: {DeliveryTag.projectile},
    ),
    statusEffects: {StatusEffectId.ignite},
    displayDetails: [
      cooldownLine(0.6),
      damageLine(8),
      projectileSpeedLine(220),
      rangeLine(440),
      projectileRadiusLine(4),
      igniteLine(dps: 3, duration: 1.4),
      knockbackLine(force: 80, duration: 0.18),
    ],
    knockbackForce: 80,
    knockbackDuration: 0.18,
  ),
  SkillDef(
    id: SkillId.waterjet,
    name: 'Holy Water Jet',
    iconId: 'skill_holy_water_jet',
    description: 'Spray a focused line of holy water.',
    tags: TagSet(elements: {ElementTag.water}, deliveries: {DeliveryTag.beam}),
    statusEffects: {StatusEffectId.slow},
    displayDetails: [
      cooldownLine(0.7),
      damageOverTimeLine(damage: 6, duration: 0.35),
      beamLengthLine(140),
      beamWidthLine(10),
      slowLine(multiplier: 0.7, duration: 0.315),
    ],
  ),
  SkillDef(
    id: SkillId.oilBombs,
    name: 'Anointing Oil Flasks',
    iconId: 'skill_anointing_oil',
    description: 'Lob flasks that slick the ground for later “purification.”',
    tags: TagSet(
      effects: {EffectTag.debuff},
      deliveries: {DeliveryTag.projectile, DeliveryTag.ground},
    ),
    statusEffects: {StatusEffectId.oilSoaked, StatusEffectId.slow},
    displayDetails: [
      cooldownLine(1.1),
      damageLine(4),
      projectileSpeedLine(160),
      rangeLine(224),
      projectileRadiusLine(6),
      groundRadiusLine(46),
      durationLine('Ground Duration', 2.0),
      damagePerSecondLine(2),
      slowLine(multiplier: 0.8, duration: 0.6),
      durationLine('Oil Duration', 1.2),
      knockbackLine(force: 60, duration: 0.16),
    ],
    knockbackForce: 60,
    knockbackDuration: 0.16,
  ),
  SkillDef(
    id: SkillId.swordThrust,
    name: 'Riteblade: Thrust',
    iconId: 'skill_riteblade_thrust',
    description: 'A precise thrust to “encourage” departure.',
    tags: TagSet(
      elements: {ElementTag.steel},
      effects: {EffectTag.mobility},
      deliveries: {DeliveryTag.melee},
    ),
    displayDetails: [
      cooldownLine(0.8),
      damageLine(10),
      rangeLine(58),
      arcLine(30),
      knockbackLine(force: 120, duration: 0.2),
    ],
    knockbackForce: 120,
    knockbackDuration: 0.2,
  ),
  SkillDef(
    id: SkillId.swordCut,
    name: 'Riteblade: Cut',
    iconId: 'skill_riteblade_cut',
    description: 'A short sweeping cut of righteous steel.',
    tags: TagSet(
      elements: {ElementTag.steel},
      effects: {EffectTag.aoe},
      deliveries: {DeliveryTag.melee},
    ),
    displayDetails: [
      cooldownLine(0.9),
      damageLine(12),
      rangeLine(46),
      arcLine(90),
      knockbackLine(force: 100, duration: 0.18),
    ],
    knockbackForce: 100,
    knockbackDuration: 0.18,
  ),
  SkillDef(
    id: SkillId.swordSwing,
    name: 'Riteblade: Swing',
    iconId: 'skill_riteblade_swing',
    description: 'A wide swing with a heavier wind-up and heavier judgement.',
    tags: TagSet(
      elements: {ElementTag.steel},
      effects: {EffectTag.aoe},
      deliveries: {DeliveryTag.melee},
    ),
    displayDetails: [
      cooldownLine(1.2),
      damageLine(14),
      rangeLine(52),
      arcLine(140),
      knockbackLine(force: 135, duration: 0.22),
    ],
    knockbackForce: 135,
    knockbackDuration: 0.22,
  ),
  SkillDef(
    id: SkillId.swordDeflect,
    name: 'Riteblade: Rebuke',
    iconId: 'skill_riteblade_rebuke',
    description: 'A quick rebuke that turns back hostile projectiles.',
    tags: TagSet(
      elements: {ElementTag.steel},
      effects: {EffectTag.support},
      deliveries: {DeliveryTag.melee},
    ),
    displayDetails: [
      cooldownLine(1.4),
      damageLine(8),
      rangeLine(42),
      arcLine(100),
      deflectRadiusLine(55),
      durationLine('Deflect Duration', 0.18),
      knockbackLine(force: 90, duration: 0.16),
    ],
    knockbackForce: 90,
    knockbackDuration: 0.16,
    deflectRadius: 55,
    deflectDuration: 0.18,
  ),
  SkillDef(
    id: SkillId.poisonGas,
    name: 'Thurible Fumes',
    iconId: 'skill_thurible_fumes',
    description:
        'A lingering cloud of “cleansing” incense that hurts to breathe.',
    tags: TagSet(
      elements: {ElementTag.poison},
      effects: {EffectTag.aoe, EffectTag.dot},
      deliveries: {DeliveryTag.aura},
    ),
    displayDetails: [
      cooldownLine(1.3),
      groundRadiusLine(70),
      damageOverTimeLine(damage: 4, duration: 0.8),
    ],
  ),
  SkillDef(
    id: SkillId.roots,
    name: 'Salt Circle',
    iconId: 'skill_salt_circle',
    description: 'A harsh ring that snares anything trying to cross it.',
    tags: TagSet(
      elements: {ElementTag.earth, ElementTag.wood},
      effects: {EffectTag.debuff},
      deliveries: {DeliveryTag.ground},
    ),
    statusEffects: {StatusEffectId.root},
    displayDetails: [
      cooldownLine(1.2),
      groundRadiusLine(54),
      damageOverTimeLine(damage: 7, duration: 1.8),
      slowLine(multiplier: 0.4, duration: 1.8, label: 'Root Slow'),
      rangeLine(60, label: 'Cast Offset'),
    ],
  ),
  SkillDef(
    id: SkillId.windCutter,
    name: 'Psalm: Razor Hymn',
    iconId: 'skill_razor_hymn',
    description: 'Sing a sharp verse; the air does the rest.',
    tags: TagSet(
      elements: {ElementTag.wind},
      deliveries: {DeliveryTag.projectile},
    ),
    metaUnlockId: MetaUnlockId.fieldManual,
    displayDetails: [
      cooldownLine(0.55),
      damageLine(7),
      projectileSpeedLine(280),
      rangeLine(392),
      projectileRadiusLine(3),
      knockbackLine(force: 70, duration: 0.16),
    ],
    knockbackForce: 70,
    knockbackDuration: 0.16,
  ),
  SkillDef(
    id: SkillId.steelShards,
    name: 'Rosary Shards',
    iconId: 'skill_rosary_shards',
    description: 'Fan out blessed fragments in a tight burst.',
    tags: TagSet(
      elements: {ElementTag.steel},
      deliveries: {DeliveryTag.projectile},
    ),
    metaUnlockId: MetaUnlockId.steelShardsLicense,
    displayDetails: [
      cooldownLine(0.9),
      damageLine(6, label: 'Shard Damage'),
      SkillDetailLine('Projectiles', '3'),
      SkillDetailLine('Spread', '±0.2 rad'),
      projectileSpeedLine(200),
      rangeLine(240),
      projectileRadiusLine(3),
      knockbackLine(force: 85, duration: 0.18),
    ],
    knockbackForce: 85,
    knockbackDuration: 0.18,
  ),
  SkillDef(
    id: SkillId.flameWave,
    name: 'Litany: Flame Sweep',
    iconId: 'skill_flame_sweep',
    description: 'A short sweeping wave of consecrated fire.',
    tags: TagSet(
      elements: {ElementTag.fire},
      effects: {EffectTag.aoe},
      deliveries: {DeliveryTag.beam},
    ),
    metaUnlockId: MetaUnlockId.flameWaveTechnique,
    displayDetails: [
      cooldownLine(1.1),
      damageOverTimeLine(damage: 10, duration: 0.45),
      beamLengthLine(120),
      beamWidthLine(18),
    ],
  ),
  SkillDef(
    id: SkillId.frostNova,
    name: 'Rite of Chill',
    iconId: 'skill_rite_of_chill',
    description: 'A cold blessing that slows everything nearby.',
    tags: TagSet(
      elements: {ElementTag.water},
      effects: {EffectTag.aoe, EffectTag.debuff},
      deliveries: {DeliveryTag.aura},
    ),
    metaUnlockId: MetaUnlockId.frostNovaDiagram,
    statusEffects: {StatusEffectId.slow},
    displayDetails: [
      cooldownLine(1.4),
      damageOverTimeLine(damage: 5, duration: 0.6),
      groundRadiusLine(80),
      slowLine(multiplier: 0.6, duration: 0.6),
    ],
  ),
  SkillDef(
    id: SkillId.earthSpikes,
    name: 'Grave-Script Spikes',
    iconId: 'skill_gravescript_spikes',
    description: 'Inscribed ground erupts into punitive spikes.',
    tags: TagSet(
      elements: {ElementTag.earth},
      effects: {EffectTag.aoe, EffectTag.dot},
      deliveries: {DeliveryTag.ground},
    ),
    metaUnlockId: MetaUnlockId.earthSpikesSurvey,
    displayDetails: [
      cooldownLine(1.3),
      damageOverTimeLine(damage: 9, duration: 0.7),
      groundRadiusLine(68),
      durationLine('Spike Duration', 0.7),
      rangeLine(72, label: 'Cast Offset'),
    ],
  ),
  SkillDef(
    id: SkillId.sporeBurst,
    name: 'Censer Spores',
    iconId: 'skill_censer_spores',
    description: 'A toxic “blessing” that lingers as a choking cloud.',
    tags: TagSet(
      elements: {ElementTag.poison},
      effects: {EffectTag.aoe, EffectTag.dot},
      deliveries: {DeliveryTag.projectile, DeliveryTag.ground},
    ),
    metaUnlockId: MetaUnlockId.sporeBurstCulture,
    displayDetails: [
      cooldownLine(1.0),
      damageLine(5),
      projectileSpeedLine(170),
      rangeLine(272),
      projectileRadiusLine(5),
      groundRadiusLine(50, label: 'Cloud Radius'),
      damageOverTimeLine(damage: 4, duration: 1.4, label: 'Cloud Damage'),
      slowLine(multiplier: 0.85, duration: 0.4),
    ],
  ),
  SkillDef(
    id: SkillId.processionIdol,
    name: 'Relic: Procession Idol',
    iconId: 'skill_procession_idol',
    description: 'A small idol patrols and nudges trespassers back.',
    tags: TagSet(elements: {ElementTag.steel}, deliveries: {DeliveryTag.melee}),
    displayDetails: [
      cooldownLine(9.5),
      durationLine('Summon Duration', 6),
      damagePerSecondLine(9),
      rangeLine(160),
      orbitRadiusLine(36),
      orbitSpeedLine(2.4),
      moveSpeedLine(120),
    ],
  ),
  SkillDef(
    id: SkillId.vigilLantern,
    name: 'Relic: Vigil Lantern',
    iconId: 'skill_vigil_lantern',
    description: 'A hovering lantern fires warding shots on its own.',
    tags: TagSet(
      elements: {ElementTag.steel},
      effects: {EffectTag.support},
      deliveries: {DeliveryTag.projectile},
    ),
    displayDetails: [
      SkillDetailLine('Summon', 'Persistent'),
      damageLine(6, label: 'Projectile Damage'),
      durationLine('Attack Cooldown', 0.75),
      projectileSpeedLine(260),
      rangeLine(220),
      projectileRadiusLine(3),
      orbitRadiusLine(44),
      orbitSpeedLine(1.6),
    ],
  ),
  SkillDef(
    id: SkillId.guardianOrbs,
    name: 'Warding Rosary',
    iconId: 'skill_warding_rosary',
    description: 'Orbiting beads keep close company and closer damage.',
    tags: TagSet(
      elements: {ElementTag.steel},
      effects: {EffectTag.support},
      deliveries: {DeliveryTag.aura},
    ),
    displayDetails: [
      SkillDetailLine('Summon', '2 orbs (persistent)'),
      damagePerSecondLine(5),
      orbitRadiusLine(34),
      orbitSpeedLine(2.8),
    ],
  ),
  SkillDef(
    id: SkillId.menderOrb,
    name: 'Absolving Wisp',
    iconId: 'skill_absolving_wisp',
    description: 'A patient little wisp that restores health over time.',
    tags: TagSet(
      elements: {ElementTag.wood},
      effects: {EffectTag.support},
      deliveries: {DeliveryTag.aura},
    ),
    displayDetails: [
      cooldownLine(9.5),
      durationLine('Summon Duration', 6),
      healingPerSecondLine(0.32),
      orbitRadiusLine(38),
      orbitSpeedLine(2.2),
    ],
  ),
  SkillDef(
    id: SkillId.mineLayer,
    name: 'Consecrated Wards',
    iconId: 'skill_consecrated_wards',
    description: 'Place wards that detonate when something unholy approaches.',
    tags: TagSet(
      elements: {ElementTag.fire},
      effects: {EffectTag.aoe},
      deliveries: {DeliveryTag.ground},
    ),
    displayDetails: [
      cooldownLine(8.0),
      damageLine(12, label: 'Blast Damage'),
      durationLine('Mine Duration', 5),
      durationLine('Arm Time', 0.25),
      rangeLine(22, label: 'Trigger Radius'),
      rangeLine(36, label: 'Blast Radius'),
    ],
  ),
  SkillDef(
    id: SkillId.chairThrow,
    name: 'Chair Throw',
    iconId: 'skill_chair_throw',
    description: 'Hurl a folding chair stamped with a binding seal.',
    tags: TagSet(
      elements: {ElementTag.wood},
      effects: {EffectTag.aoe},
      deliveries: {DeliveryTag.projectile},
    ),
    displayDetails: [
      cooldownLine(0.95),
      damageLine(9),
      projectileSpeedLine(200),
      rangeLine(320),
      projectileRadiusLine(7),
      knockbackLine(force: 110, duration: 0.2),
    ],
    knockbackForce: 110,
    knockbackDuration: 0.2,
  ),
  SkillDef(
    id: SkillId.absolutionSlap,
    name: 'Slap of Absolution',
    iconId: 'skill_absolution_slap',
    description: 'A brisk palm strike that clears a tight arc.',
    tags: TagSet(
      elements: {ElementTag.wind},
      effects: {EffectTag.aoe},
      deliveries: {DeliveryTag.melee},
    ),
    displayDetails: [
      cooldownLine(0.8),
      damageLine(8),
      rangeLine(40),
      arcLine(70),
      knockbackLine(force: 95, duration: 0.16),
    ],
    knockbackForce: 95,
    knockbackDuration: 0.16,
  ),
];

final Map<SkillId, SkillDef> skillDefsById = Map.unmodifiable({
  for (final def in skillDefs) def.id: def,
});
